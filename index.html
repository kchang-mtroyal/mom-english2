<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê®ÇÈΩ°Ëã±Ë™ûÂ∞èÂ≠∏Â†Ç</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; touch-action: manipulation; overscroll-behavior: none; }
        .btn-press:active { transform: scale(0.95); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .pulse-animation { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Ë≥áÊñôÂ∫´ (ÂÆåÊï¥Êì¥ÂÖÖÁâà) ---
        const levelsData = [
            {
                level: 1,
                title: "Á≠âÁ¥ö 1ÔºöÂü∫Á§éÂÖ•ÈñÄ",
                badge: "üå±",
                badgeName: "Êñ∞ÊâãÁ®ÆÂ≠ê",
                desc: "ÂÆåÊï¥Êï∏Â≠ó„ÄÅÊó•ÊúüËàáÂ§©Ê∞£",
                categories: [
                    {
                        id: 'l1_numbers_basic', title: 'Êï∏Â≠ó 1-10', words: [
                            { en: 'One', ipa: 'w ån', zh: '‰∏Ä', pronunciation: 'Ëê¨', sentence: 'One apple.' },
                            { en: 'Two', ipa: 'tuÀê', zh: '‰∫å', pronunciation: 'ÂÖî', sentence: 'Two cats.' },
                            { en: 'Three', ipa: 'Œ∏riÀê', zh: '‰∏â', pronunciation: 'Ê≠≤', sentence: 'Three o\'clock.' },
                            { en: 'Four', ipa: 'f…îÀêr', zh: 'Âõõ', pronunciation: '‰Ωõ', sentence: 'Four seasons.' },
                            { en: 'Five', ipa: 'fa…™v', zh: '‰∫î', pronunciation: 'Ê≥ïÂ§´', sentence: 'High five!' },
                            { en: 'Six', ipa: 's…™ks', zh: 'ÂÖ≠', pronunciation: 'Â∏åÂÖãÊñØ', sentence: 'Six eggs.' },
                            { en: 'Seven', ipa: 'Ààs…õvn', zh: '‰∏É', pronunciation: 'Â°û-ÂàÜ', sentence: 'Seven days a week.' },
                            { en: 'Eight', ipa: 'e…™t', zh: 'ÂÖ´', pronunciation: 'Ê¨∏-Áâπ', sentence: 'Eight o\'clock.' },
                            { en: 'Nine', ipa: 'na…™n', zh: '‰πù', pronunciation: 'Â•à', sentence: 'Nine lives.' },
                            { en: 'Ten', ipa: 't…õn', zh: 'ÂçÅ', pronunciation: 'Â§©', sentence: 'Count to ten.' },
                        ]
                    },
                    {
                        id: 'l1_numbers_adv', title: 'Êï∏Â≠ó 11-100', words: [
                            { en: 'Eleven', ipa: '…™Ààl…õvn', zh: 'ÂçÅ‰∏Ä', pronunciation: '‰∏Ä-Á¥Ø-ÂàÜ', sentence: 'Eleven players.' },
                            { en: 'Twelve', ipa: 'tw…õlv', zh: 'ÂçÅ‰∫å', pronunciation: 'Êãñ-Áàæ-Â§´', sentence: 'Twelve months.' },
                            { en: 'Twenty', ipa: 'Ààtw…õnti', zh: '‰∫åÂçÅ', pronunciation: 'Âúò-Ë∏¢', sentence: 'Twenty dollars.' },
                            { en: 'Thirty', ipa: 'ÀàŒ∏…úÀêrti', zh: '‰∏âÂçÅ', pronunciation: 'Áëü-Ë∏¢', sentence: 'Thirty days.' },
                            { en: 'Fifty', ipa: 'Ààf…™fti', zh: '‰∫îÂçÅ', pronunciation: 'È£õÂ§´-Ë∏¢', sentence: 'Fifty percent.' },
                            { en: 'Hundred', ipa: 'Ààh åndr…ôd', zh: 'Áôæ', pronunciation: 'Êù≠-Áàµ-Âæó', sentence: 'One hundred.' },
                        ]
                    },
                    {
                        id: 'l1_week', title: '‰∏ÄÊòüÊúü‰∏ÉÂ§©', words: [
                            { en: 'Monday', ipa: 'Ààm ånde…™', zh: 'ÊòüÊúü‰∏Ä', pronunciation: 'Êõº-day', sentence: 'Blue Monday.' },
                            { en: 'Tuesday', ipa: 'ÀàtjuÀêzde…™', zh: 'ÊòüÊúü‰∫å', pronunciation: 'Âêê-Ê≠ª-day', sentence: 'See you Tuesday.' },
                            { en: 'Wednesday', ipa: 'Ààw…õnzde…™', zh: 'ÊòüÊúü‰∏â', pronunciation: 'Ê∫´-Ê≠ª-day', sentence: 'Wednesday meeting.' },
                            { en: 'Thursday', ipa: 'ÀàŒ∏…úÀêrzde…™', zh: 'ÊòüÊúüÂõõ', pronunciation: 'Áëü-Ê≠ª-day', sentence: 'Throwback Thursday.' },
                            { en: 'Friday', ipa: 'Ààfra…™de…™', zh: 'ÊòüÊúü‰∫î', pronunciation: 'Á¶è‰æÜ-day', sentence: 'Happy Friday!' },
                            { en: 'Saturday', ipa: 'Ààs√¶t…ôrde…™', zh: 'ÊòüÊúüÂÖ≠', pronunciation: 'Â°û-Áâπ-day', sentence: 'Saturday night.' },
                            { en: 'Sunday', ipa: 'Ààs ånde…™', zh: 'ÊòüÊúüÊó•', pronunciation: 'Áèä-day', sentence: 'Sunday is a holiday.' },
                        ]
                    },
                    {
                        id: 'l1_months_1', title: '‰∏ÄÊúàÂà∞ÂÖ≠Êúà', words: [
                            { en: 'January', ipa: 'Ààd í√¶nju…ôri', zh: '‰∏ÄÊúà', pronunciation: 'Èñì-Áâõ-ÁàæÁëû', sentence: 'January is cold.' },
                            { en: 'February', ipa: 'Ààf…õbru…ôri', zh: '‰∫åÊúà', pronunciation: 'È£õ-Â∏ÉÈ≠Ø-ÁàæÁëû', sentence: 'Valentine in February.' },
                            { en: 'March', ipa: 'm…ëÀêrt É', zh: '‰∏âÊúà', pronunciation: 'ÁΩµ-Âéª', sentence: 'March spring.' },
                            { en: 'April', ipa: 'Ààe…™pr…ôl', zh: 'ÂõõÊúà', pronunciation: 'Ê¨∏-ÊôÆÊüî', sentence: 'April fools.' },
                            { en: 'May', ipa: 'me…™', zh: '‰∫îÊúà', pronunciation: 'Ê¢Ö', sentence: 'May flower.' },
                            { en: 'June', ipa: 'd íuÀên', zh: 'ÂÖ≠Êúà', pronunciation: 'Êú±-ÊÅ©', sentence: 'June bride.' },
                        ]
                    },
                    {
                        id: 'l1_months_2', title: '‰∏ÉÊúàÂà∞ÂçÅ‰∫åÊúà', words: [
                            { en: 'July', ipa: 'd íuÀàla…™', zh: '‰∏ÉÊúà', pronunciation: 'Êú±-‰æÜ', sentence: 'July summer.' },
                            { en: 'August', ipa: 'Àà…îÀê…°…ôst', zh: 'ÂÖ´Êúà', pronunciation: 'Â•ß-Ëëõ-Ê≠ªÁâπ', sentence: 'August heat.' },
                            { en: 'September', ipa: 's…õpÀàt…õmb…ôr', zh: '‰πùÊúà', pronunciation: 'Ëâ≤ÊôÆ-Â§©-‰ºØ', sentence: 'September school.' },
                            { en: 'October', ipa: '…íkÀàto äb…ôr', zh: 'ÂçÅÊúà', pronunciation: 'Â•ß-ÂÖã-ÂÅ∑-‰ºØ', sentence: 'October pumpkin.' },
                            { en: 'November', ipa: 'no äÀàv…õmb…ôr', zh: 'ÂçÅ‰∏ÄÊúà', pronunciation: 'Ë´æ-Ëä¨-‰ºØ', sentence: 'November rain.' },
                            { en: 'December', ipa: 'd…™Ààs…õmb…ôr', zh: 'ÂçÅ‰∫åÊúà', pronunciation: '‰Ωé-Ê£Æ-Êüè', sentence: 'December Christmas.' },
                        ]
                    },
                    {
                        id: 'l1_weather', title: 'Â§©Ê∞£ËàáÂïèÂÄô', words: [
                            { en: 'Sunny', ipa: 'Ààs åni', zh: 'Êô¥Â§©', pronunciation: 'Ê°ë-Ê≥•', sentence: 'It is sunny.' },
                            { en: 'Rainy', ipa: 'Ààre…™ni', zh: 'Èõ®Â§©', pronunciation: 'Áëû-Ê≥•', sentence: 'It is rainy.' },
                            { en: 'Cloudy', ipa: 'Ààkla ädi', zh: 'Â§öÈõ≤', pronunciation: 'ÂÖãÂãû-Â∫ï', sentence: 'It is cloudy.' },
                            { en: 'Windy', ipa: 'Ààw…™ndi', zh: 'È¢≥È¢®', pronunciation: 'Ê∫´-Â∫ï', sentence: 'It is windy.' },
                            { en: 'Hello', ipa: 'h…ôÀàlo ä', zh: '‰Ω†Â•Ω', pronunciation: 'Âìà-Âõâ', sentence: 'Hello there.' },
                            { en: 'Thank you', ipa: 'Œ∏√¶≈ãk juÀê', zh: 'Ë¨ùË¨ù', pronunciation: '‰∏â-Q', sentence: 'Thank you.' },
                            { en: 'Goodbye', ipa: '…° ädÀàba…™', zh: 'ÂÜçË¶ã', pronunciation: 'Âè§-Âæó-Êãú', sentence: 'Goodbye, see you.' },
                        ]
                    }
                ]
            },
            {
                level: 2,
                title: "Á≠âÁ¥ö 2ÔºöÁîüÊ¥ªÂü∫Á§é",
                badge: "üåø",
                badgeName: "ËåÅÂ£ØÂ´©Ëëâ",
                desc: "ÂÆ∂Â∫≠„ÄÅË∫´È´îËàáÈ°èËâ≤ (ÁõÆÊ®ô120Â≠ó)",
                categories: [
                    {
                        id: 'l2_family', title: 'ÂÆ∂Â∫≠ÊàêÂì°', words: [
                            { en: 'Father', ipa: 'Ààf…ëÀê√∞…ôr', zh: 'Áà∂Ë¶™/Áà∏Áà∏', pronunciation: 'Ê≥ï-Âæó', sentence: 'My father is tall.' },
                            { en: 'Mother', ipa: 'Ààm å√∞…ôr', zh: 'ÊØçË¶™/Â™ΩÂ™Ω', pronunciation: 'Â™Ω-Âæó', sentence: 'I love my mother.' },
                            { en: 'Grandpa', ipa: 'Àà…°r√¶np…ëÀê', zh: 'Áà∫Áà∫/Â§ñÂÖ¨', pronunciation: 'ËëõÁëû-Â∏ï', sentence: 'Grandpa is old.' },
                            { en: 'Grandma', ipa: 'Àà…°r√¶nm…ëÀê', zh: 'Â•∂Â•∂/Â§ñÂ©Ü', pronunciation: 'ËëõÁëû-Â™Ω', sentence: 'Grandma is kind.' },
                            { en: 'Brother', ipa: 'Ààbr å√∞…ôr', zh: 'ÂÖÑÂºü', pronunciation: 'Â∏ÉÊãâ-Âæó', sentence: 'He is my brother.' },
                            { en: 'Sister', ipa: 'Ààs…™st…ôr', zh: 'ÂßäÂ¶π', pronunciation: 'Â∏å-Ê≠ª-Áâπ', sentence: 'She is my sister.' },
                            { en: 'Son', ipa: 's ån', zh: 'ÂÖíÂ≠ê', pronunciation: 'Ê°ë', sentence: 'My son.' },
                            { en: 'Daughter', ipa: 'Ààd…îÀêt…ôr', zh: 'Â•≥ÂÖí', pronunciation: 'Â§ö-Áâπ', sentence: 'My daughter.' },
                        ]
                    },
                    {
                        id: 'l2_body', title: 'Ë∫´È´îÈÉ®‰Ωç', words: [
                            { en: 'Head', ipa: 'h…õd', zh: 'È†≠', pronunciation: 'Èªë-Âæó', sentence: 'Nod your head.' },
                            { en: 'Hair', ipa: 'h…õr', zh: 'È†≠È´Æ', pronunciation: 'Èªë-Áàæ', sentence: 'Black hair.' },
                            { en: 'Eye', ipa: 'a…™', zh: 'ÁúºÁùõ', pronunciation: 'ÊÑõ', sentence: 'Big eyes.' },
                            { en: 'Nose', ipa: 'no äz', zh: 'ÈºªÂ≠ê', pronunciation: 'Ë´æ-Ê≠ª', sentence: 'Touch your nose.' },
                            { en: 'Mouth', ipa: 'ma äŒ∏', zh: 'Âò¥Â∑¥', pronunciation: 'ËåÇ-ÊÄù', sentence: 'Open your mouth.' },
                            { en: 'Hand', ipa: 'h√¶nd', zh: 'Êâã', pronunciation: 'Êº¢-Âæó', sentence: 'Wash hands.' },
                            { en: 'Foot', ipa: 'f ät', zh: 'ËÖ≥', pronunciation: 'ÂØå-Áâπ', sentence: 'Left foot.' },
                        ]
                    },
                    {
                        id: 'l2_colors', title: 'Ë±êÂØåËâ≤ÂΩ©', words: [
                            { en: 'Red', ipa: 'r…õd', zh: 'Á¥ÖËâ≤', pronunciation: 'Áëû-Âæó', sentence: 'Red apple.' },
                            { en: 'Blue', ipa: 'bluÀê', zh: 'ËóçËâ≤', pronunciation: 'Â∏ÉÈ≠Ø', sentence: 'Blue sky.' },
                            { en: 'Green', ipa: '…°riÀên', zh: 'Á∂†Ëâ≤', pronunciation: 'ËëõÁëû-ÊÅ©', sentence: 'Green grass.' },
                            { en: 'Yellow', ipa: 'Ààj…õlo ä', zh: 'ÈªÉËâ≤', pronunciation: 'Ëëâ-Ê®ì', sentence: 'Yellow banana.' },
                            { en: 'Orange', ipa: 'Àà…îÀêr…™nd í', zh: 'Ê©òËâ≤', pronunciation: 'Ê≠ê-Áëû-Âêâ', sentence: 'Orange fruit.' },
                            { en: 'Purple', ipa: 'Ààp…úÀêrpl', zh: 'Á¥´Ëâ≤', pronunciation: 'Ê≥¢-Ââñ', sentence: 'Purple grape.' },
                            { en: 'Black', ipa: 'bl√¶k', zh: 'ÈªëËâ≤', pronunciation: 'Â∏ÉËêä-ÂÖã', sentence: 'Black car.' },
                            { en: 'White', ipa: 'wa…™t', zh: 'ÁôΩËâ≤', pronunciation: 'Â£û-Áâπ', sentence: 'White snow.' },
                        ]
                    }
                ]
            },
            {
                level: 3,
                title: "Á≠âÁ¥ö 3ÔºöÊó•Â∏∏‰∫ãÁâ©",
                badge: "üå≥",
                badgeName: "Á©©Âõ∫Â∞èÊ®π",
                desc: "È£üÁâ©„ÄÅÂ±ÖÂÆ∂ËàáÂãï‰Ωú (ÁõÆÊ®ô180Â≠ó)",
                categories: [
                    {
                        id: 'l3_food', title: 'È£üÁâ©ËàáÈ£≤Êñô', words: [
                            { en: 'Water', ipa: 'Ààw…îÀêt…ôr', zh: 'Ê∞¥', pronunciation: 'Ê≤É-Áâπ', sentence: 'Drink water.' },
                            { en: 'Tea', ipa: 'tiÀê', zh: 'Ëå∂', pronunciation: 'Ë∏¢', sentence: 'Hot tea.' },
                            { en: 'Coffee', ipa: 'Ààk…îÀêfi', zh: 'ÂíñÂï°', pronunciation: 'Âíñ-È£õ', sentence: 'Black coffee.' },
                            { en: 'Milk', ipa: 'm…™lk', zh: 'ÁâõÂ•∂', pronunciation: 'Á±≥-Ê≠ê-ÂÖã', sentence: 'Fresh milk.' },
                            { en: 'Bread', ipa: 'br…õd', zh: 'È∫µÂåÖ', pronunciation: 'Â∏ÉÁëû-Âæó', sentence: 'Eat bread.' },
                            { en: 'Rice', ipa: 'ra…™s', zh: 'È£Ø', pronunciation: 'Áëû-Ê≠ª', sentence: 'White rice.' },
                            { en: 'Noodle', ipa: 'ÀànuÀêdl', zh: 'È∫µ', pronunciation: 'ÊÄí-Ë±Ü', sentence: 'Beef noodle.' },
                            { en: 'Egg', ipa: '…õ…°', zh: 'Ëõã', pronunciation: 'Ê¨∏-Ê†º', sentence: 'Fried egg.' },
                        ]
                    },
                    {
                        id: 'l3_fruits', title: 'Ê∞¥Êûú', words: [
                            { en: 'Apple', ipa: 'Àà√¶pl', zh: 'ËòãÊûú', pronunciation: 'ÊÑõ-Ââñ', sentence: 'Red apple.' },
                            { en: 'Banana', ipa: 'b…ôÀàn√¶n…ô', zh: 'È¶ôËïâ', pronunciation: 'Â∑¥-ÈÇ£-ÈÇ£', sentence: 'Sweet banana.' },
                            { en: 'Orange', ipa: 'Àà…îÀêr…™nd í', zh: 'Êü≥Ê©ô', pronunciation: 'Ê≠ê-Áëû-Âêâ', sentence: 'Juicy orange.' },
                            { en: 'Grape', ipa: '…°re…™p', zh: 'Ëë°ËêÑ', pronunciation: 'ËëõÁëû-ÊôÆ', sentence: 'Purple grape.' },
                            { en: 'Lemon', ipa: 'Ààl…õm…ôn', zh: 'Ê™∏Ê™¨', pronunciation: 'Èõ∑-Ëêå', sentence: 'Sour lemon.' },
                        ]
                    },
                    {
                        id: 'l3_home', title: 'Â±ÖÂÆ∂Áí∞Â¢É', words: [
                            { en: 'House', ipa: 'ha äs', zh: 'ÊàøÂ≠ê', pronunciation: 'Ë±™-Ê≠ª', sentence: 'Big house.' },
                            { en: 'Room', ipa: 'ruÀêm', zh: 'ÊàøÈñì', pronunciation: 'ÂÖ•-ÂßÜ', sentence: 'My room.' },
                            { en: 'Door', ipa: 'd…îÀêr', zh: 'ÈñÄ', pronunciation: 'Â§ö-Áàæ', sentence: 'Open the door.' },
                            { en: 'Window', ipa: 'Ààw…™ndo ä', zh: 'Á™óÊà∂', pronunciation: 'Ê∫´-Ë±Ü', sentence: 'Close window.' },
                            { en: 'Table', ipa: 'Ààte…™bl', zh: 'Ê°åÂ≠ê', pronunciation: 'Êé®-Ââñ', sentence: 'On the table.' },
                            { en: 'Bed', ipa: 'b…õd', zh: 'Â∫ä', pronunciation: 'Ë≤ù-Âæó', sentence: 'Go to bed.' },
                        ]
                    }
                ]
            },
            {
                level: 4,
                title: "Á≠âÁ¥ö 4ÔºöË°åÂãïËàáÊÑüÂèó",
                badge: "üå∫",
                badgeName: "ÁõõÈñãËä±Êúµ",
                desc: "‰∫§ÈÄö„ÄÅÂ†¥ÊâÄËàáÊÑüË¶∫ (ÁõÆÊ®ô240Â≠ó)",
                categories: [
                    {
                        id: 'l4_verbs', title: 'Â∏∏Áî®Âãï‰Ωú', words: [
                            { en: 'Eat', ipa: 'iÀêt', zh: 'ÂêÉ', pronunciation: '‰∏Ä-Áâπ', sentence: 'Eat breakfast.' },
                            { en: 'Drink', ipa: 'dr…™≈ãk', zh: 'Âñù', pronunciation: 'Âùá-ÂÖã', sentence: 'Drink tea.' },
                            { en: 'Sleep', ipa: 'sliÀêp', zh: 'Áù°Ë¶∫', pronunciation: 'Ê≠ª-Âäõ-ÊôÆ', sentence: 'Sleep well.' },
                            { en: 'Go', ipa: '…°o ä', zh: 'Âéª', pronunciation: 'Â§†', sentence: 'Go home.' },
                            { en: 'Come', ipa: 'k åm', zh: '‰æÜ', pronunciation: 'Â∫∑', sentence: 'Come here.' },
                            { en: 'Walk', ipa: 'w…îÀêk', zh: 'Ëµ∞Ë∑Ø', pronunciation: 'Ê≤É-ÂÖã', sentence: 'Walk slow.' },
                            { en: 'Run', ipa: 'r ån', zh: 'Ë∑ë', pronunciation: 'ËÆì', sentence: 'Run fast.' },
                            { en: 'See', ipa: 'siÀê', zh: 'Áúã/ÁúãË¶ã', pronunciation: '‰øÇ', sentence: 'I see you.' },
                        ]
                    },
                    {
                        id: 'l4_feelings', title: 'ÊÑüË¶∫ËàáÂΩ¢ÂÆπ', words: [
                            { en: 'Happy', ipa: 'Ààh√¶pi', zh: 'Âø´Ê®Ç', pronunciation: 'Èªë-ÁöÆ', sentence: 'I am happy.' },
                            { en: 'Sad', ipa: 's√¶d', zh: 'Èõ£ÈÅé', pronunciation: 'Â°û-Âæó', sentence: 'Don\'t be sad.' },
                            { en: 'Hungry', ipa: 'Ààh å≈ã…°ri', zh: 'È§ì', pronunciation: 'Â§Ø-ËëõÁëû', sentence: 'I am hungry.' },
                            { en: 'Tired', ipa: 'Ààta…™…ôrd', zh: 'Á¥Ø', pronunciation: 'Â§™-Áàæ-Âæó', sentence: 'So tired.' },
                            { en: 'Good', ipa: '…° äd', zh: 'Â•Ω', pronunciation: 'È°ß-Âæó', sentence: 'Very good.' },
                            { en: 'Bad', ipa: 'b√¶d', zh: 'Â£û/‰∏çÂ•Ω', pronunciation: 'Êãú-Âæó', sentence: 'Not bad.' },
                            { en: 'Big', ipa: 'b…™…°', zh: 'Â§ß', pronunciation: 'Áï¢-Ê†º', sentence: 'Big apple.' },
                            { en: 'Small', ipa: 'sm…îÀêl', zh: 'Â∞è', pronunciation: 'Ê≠ª-Ëé´', sentence: 'Small cat.' },
                        ]
                    }
                ]
            },
            {
                level: 5,
                title: "Á≠âÁ¥ö 5ÔºöËã±Ë™ûÈÅî‰∫∫",
                badge: "üëë",
                badgeName: "Ê¶ÆËÄÄÁöáÂÜ†",
                desc: "ÊóÖÈÅä„ÄÅË≥ºÁâ©ËàáÂØ¶Áî®Âè• (ÁõÆÊ®ô300Â≠ó)",
                categories: [
                    {
                        id: 'l5_travel', title: 'ÊóÖÈÅäËàá‰∫§ÈÄö', words: [
                            { en: 'Bus', ipa: 'b ås', zh: 'ÂÖ¨Ëªä', pronunciation: 'Â∑¥-Ê≠ª', sentence: 'Bus stop.' },
                            { en: 'Train', ipa: 'tre…™n', zh: 'ÁÅ´Ëªä', pronunciation: 'Âêπ-ÊÅ©', sentence: 'Train station.' },
                            { en: 'Taxi', ipa: 'Ààt√¶ksi', zh: 'Ë®àÁ®ãËªä', pronunciation: 'Â§™-ÂÖã-Á≥ª', sentence: 'Call a taxi.' },
                            { en: 'Airport', ipa: 'Àà…õrp…îÀêrt', zh: 'Ê©üÂ†¥', pronunciation: 'Ê¨∏-Áàæ-Ê≥¢-Áâπ', sentence: 'To the airport.' },
                            { en: 'Hotel', ipa: 'ho äÀàt…õl', zh: 'È£ØÂ∫ó', pronunciation: 'Âêº-ÂÅ∑', sentence: 'Nice hotel.' },
                            { en: 'Ticket', ipa: 'Ààt…™k…™t', zh: 'Á•®', pronunciation: 'Ë∏¢-ÂÖã-Áâπ', sentence: 'One ticket.' },
                            { en: 'Map', ipa: 'm√¶p', zh: 'Âú∞Âúñ', pronunciation: 'Ê¢Ö-ÊôÆ', sentence: 'Look at the map.' },
                        ]
                    },
                    {
                        id: 'l5_shopping', title: 'Ë≥ºÁâ©ËàáÈáëÈå¢', words: [
                            { en: 'Money', ipa: 'Ààm åni', zh: 'Èå¢', pronunciation: 'Â™Ω-Ê≥•', sentence: 'No money.' },
                            { en: 'Buy', ipa: 'ba…™', zh: 'Ë≤∑', pronunciation: 'Êãú', sentence: 'Buy food.' },
                            { en: 'Expensive', ipa: '…™kÀàsp…õns…™v', zh: 'Ë≤¥', pronunciation: '‰∏Ä-ÂèØ-Ê≠ª-Âô¥-Â∏å-Â§´', sentence: 'Too expensive.' },
                            { en: 'Cheap', ipa: 't ÉiÀêp', zh: '‰æøÂÆú', pronunciation: 'Ê∞£-ÊôÆ', sentence: 'Very cheap.' },
                            { en: 'How much', ipa: 'ha ä m åt É', zh: 'Â§öÂ∞ëÈå¢', pronunciation: 'Ë±™-È∫ª-Âéª', sentence: 'How much is it?' },
                        ]
                    },
                    {
                        id: 'l5_emergency', title: 'Á∑äÊÄ•ËàáÂÖ∂‰ªñ', words: [
                            { en: 'Help', ipa: 'h…õlp', zh: 'Âπ´Âøô', pronunciation: 'Èªë-Ê≠ê-ÊôÆ', sentence: 'Help me.' },
                            { en: 'Toilet', ipa: 'Ààt…î…™l…™t', zh: 'ÂªÅÊâÄ', pronunciation: 'ÂÅ∑-‰∏Ä-Âãí-Áâπ', sentence: 'Where is the toilet?' },
                            { en: 'Sorry', ipa: 'Ààs…íri', zh: 'Â∞ç‰∏çËµ∑', pronunciation: 'È®∑-Áëû', sentence: 'I am sorry.' },
                            { en: 'Yes', ipa: 'j…õs', zh: 'ÊòØ/Â∞ç', pronunciation: 'Ëëâ-Ê≠ª', sentence: 'Yes, please.' },
                            { en: 'No', ipa: 'no ä', zh: '‰∏ç', pronunciation: 'Ë´æ', sentence: 'No, thanks.' },
                        ]
                    }
                ]
            }
        ];

        // --- ÁµÑ‰ª∂ÔºöÂúñÊ®ô ---
        const Icon = ({ name, size = 24, className }) => {
            const icons = {
                volume: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>,
                star: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
                arrowRight: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
                home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
                refresh: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>,
                check: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
                x: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
                mic: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>,
                settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
                lock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            };
            return icons[name] || null;
        };

        // --- ‰∏ªÁ®ãÂºè ---
        const App = () => {
            const [screen, setScreen] = useState('home'); 
            const [activeCategory, setActiveCategory] = useState(null); // Áï∂ÂâçÈÅ∏ÊìáÁöÑÂñÆÂÖÉ
            const [activeWords, setActiveWords] = useState([]); 
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [userProgress, setUserProgress] = useState({}); // { wordEn: proficiencyLevel }
            const [quizOptions, setQuizOptions] = useState([]);
            const [quizFeedback, setQuizFeedback] = useState(null);
            const [speechRate, setSpeechRate] = useState(0.6); // È†êË®≠60%
            
            // Ë™ûÈü≥ÈÅ∏ÊìáÁõ∏Èóú State
            const [availableVoices, setAvailableVoices] = useState([]);
            const [selectedVoice, setSelectedVoice] = useState(null);
            const [showVoiceModal, setShowVoiceModal] = useState(false);

            // Ë™ûÈü≥Ë≠òÂà•Áõ∏Èóú State
            const [isListening, setIsListening] = useState(false);
            const [speakFeedback, setSpeakFeedback] = useState(null); 
            const [recognizedText, setRecognizedText] = useState('');
            const recognitionRef = useRef(null);

            // Ref Áî®ÊñºËß£Ê±∫Ë™ûÈü≥Ë≠òÂà• callback ‰∏≠ÁöÑÈñâÂåÖÂïèÈ°å
            const stateRef = useRef({ activeWords: [], currentIndex: 0 });

            useEffect(() => {
                stateRef.current = { activeWords, currentIndex };
            }, [activeWords, currentIndex]);

            // Ë®àÁÆó‰ΩøÁî®ËÄÖÁ≠âÁ¥ö
            const userLevelInfo = useMemo(() => {
                const masteredCount = Object.values(userProgress).filter(p => p >= 3).length;
                
                // Á∞°ÂñÆÁöÑÂçáÁ¥öÈÇèËºØ
                let currentLevel = 1;
                if (masteredCount > 180) currentLevel = 5;
                else if (masteredCount > 100) currentLevel = 4;
                else if (masteredCount > 50) currentLevel = 3;
                else if (masteredCount > 20) currentLevel = 2;

                // ÂèñÂæóË©≤Á≠âÁ¥öÁöÑË≥áÊñô
                const levelData = levelsData.find(l => l.level === currentLevel) || levelsData[0];
                return {
                    level: currentLevel,
                    badge: levelData.badge,
                    badgeName: levelData.badgeName,
                    masteredCount: masteredCount
                };
            }, [userProgress]);

            // ÂàùÂßãÂåñË™ûÈü≥ÂàóË°® (ÂêåÂâç)
            useEffect(() => {
                const loadVoices = () => {
                    const allVoices = window.speechSynthesis.getVoices();
                    const enVoices = allVoices.filter(v => v.lang.startsWith('en'));
                    
                    enVoices.sort((a, b) => {
                        const isGoodA = isHighQuality(a);
                        const isGoodB = isHighQuality(b);
                        if (isGoodA && !isGoodB) return -1;
                        if (!isGoodA && isGoodB) return 1;
                        return 0;
                    });

                    setAvailableVoices(enVoices);
                    if (enVoices.length > 0 && !selectedVoice) {
                        setSelectedVoice(enVoices[0]);
                    }
                };

                const isHighQuality = (voice) => {
                    const name = voice.name.toLowerCase();
                    return name.includes('siri') || 
                           name.includes('enhanced') || 
                           name.includes('premium') || 
                           name.includes('google') ||
                           name.includes('natural');
                };

                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, [selectedVoice]);

            // ÂàùÂßãÂåñË™ûÈü≥Ë≠òÂà• (ÂêåÂâç)
            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognitionRef.current = new SpeechRecognition();
                    recognitionRef.current.continuous = false;
                    recognitionRef.current.lang = 'en-US';
                    recognitionRef.current.interimResults = false;

                    recognitionRef.current.onstart = () => { setIsListening(true); };

                    recognitionRef.current.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setRecognizedText(transcript);
                        
                        const { activeWords, currentIndex } = stateRef.current;
                        if (activeWords && activeWords.length > currentIndex) {
                             const currentWord = activeWords[currentIndex];
                             const target = currentWord.en.toLowerCase();
                             const targetNum = target.replace(/,/g, ''); 
                             const spoken = transcript.toLowerCase();
                             
                             if (spoken.includes(target) || 
                                 target.includes(spoken) || 
                                 spoken.includes(targetNum) || 
                                 spoken.replace(/,/g, '') === targetNum) {
                                 setSpeakFeedback('match');
                                 speak(currentWord.en); 
                             } else {
                                 setSpeakFeedback('no-match');
                                 speak('Try again');
                             }
                        }
                        setIsListening(false);
                    };

                    recognitionRef.current.onerror = (event) => {
                        console.error('Speech error', event.error);
                        setIsListening(false);
                        if (event.error !== 'no-speech') setSpeakFeedback('error');
                    };
                    recognitionRef.current.onend = () => { setIsListening(false); };
                }
                return () => {
                    if (recognitionRef.current) {
                        try { recognitionRef.current.abort(); } catch (e) {}
                    }
                };
            }, []);

            useEffect(() => {
                const savedProgress = localStorage.getItem('englishAppProgress');
                if (savedProgress) {
                    setUserProgress(JSON.parse(savedProgress));
                }
            }, []);

            const updateProgress = (word, isCorrect) => {
                const newProgress = { ...userProgress };
                const currentScore = newProgress[word] || 0;
                if (isCorrect) {
                    newProgress[word] = Math.min(currentScore + 1, 5); 
                } else {
                    newProgress[word] = Math.max(currentScore - 1, 0);
                }
                setUserProgress(newProgress);
                localStorage.setItem('englishAppProgress', JSON.stringify(newProgress));
            };

            const speak = (text, overrideRate = null) => {
                window.speechSynthesis.cancel();
                const englishText = text.replace(/\(.*\)/, ''); 
                
                const isLongNumber = /\d{3,}/.test(englishText);
                let rateToUse = overrideRate !== null ? overrideRate : speechRate;
                if (overrideRate === null && isLongNumber && speechRate > 0.7) {
                    rateToUse = 0.7;
                }

                const utterance = new SpeechSynthesisUtterance(englishText);
                utterance.lang = 'en-US';
                if (selectedVoice) utterance.voice = selectedVoice;
                utterance.rate = rateToUse;
                window.speechSynthesis.speak(utterance);
            };

            const selectVoiceAndTest = (voice) => {
                setSelectedVoice(voice);
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance("Hello, Rosa, How are you today?");
                    utterance.voice = voice;
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }, 100);
            };

            const startListening = () => {
                if (!recognitionRef.current) {
                    alert("Êä±Ê≠âÔºåÊÇ®ÁöÑÊâãÊ©üÁÄèË¶ΩÂô®‰∏çÊîØÊè¥Ë™ûÈü≥Ëæ®Ë≠òÂäüËÉΩ„ÄÇ");
                    return;
                }
                if (isListening) {
                    recognitionRef.current.stop();
                    return;
                }
                setSpeakFeedback(null);
                setRecognizedText('');
                setIsListening(true);
                try {
                    recognitionRef.current.start();
                } catch (e) {
                    if (e.name === 'InvalidStateError' || e.message.includes('already started')) {
                        try { recognitionRef.current.stop(); } catch (err) {}
                        setIsListening(false);
                    } else {
                        setIsListening(false);
                    }
                }
            };

            const currentWord = activeWords[currentIndex];

            // ÂïüÂãïÁâπÂÆöÂàÜÈ°ûÁöÑË™≤Á®ã
            const startCategory = (category) => {
                setActiveWords(category.words);
                setActiveCategory(category);
                setCurrentIndex(0);
                setSpeakFeedback(null);
                setScreen('learn');
            };

            const startReview = () => {
                // Êî∂ÈõÜÊâÄÊúâÂñÆÂ≠ó
                const allWords = [];
                levelsData.forEach(lvl => {
                    lvl.categories.forEach(cat => {
                        allWords.push(...cat.words);
                    });
                });

                const weakWords = allWords.filter(w => (userProgress[w.en] || 0) < 3);
                // ÂÑ™ÂÖàË§áÁøíÂº±È†ÖÔºå‰∏çÂ§†ÂâáË£úÈö®Ê©ü
                let reviewWords = [];
                if (weakWords.length > 0) {
                    reviewWords = weakWords.slice(0, 15);
                } else {
                    reviewWords = allWords.sort(() => 0.5 - Math.random()).slice(0, 15);
                }
                
                // Âª∫Á´ã‰∏ÄÂÄãËá®ÊôÇÁöÑË§áÁøíÁî®ÂàÜÈ°ûÁâ©‰ª∂
                const reviewCategory = {
                    id: 'review',
                    title: 'Ë§áÁøíÊ®°Âºè',
                    words: reviewWords
                };
                
                startCategory(reviewCategory);
            };

            const generateQuizOptions = (correctWord) => {
                // Êî∂ÈõÜÊâÄÊúâÂñÆÂ≠ó‰ΩúÁÇ∫Âπ≤ÊìæÈ†Ö
                const allWords = [];
                levelsData.forEach(lvl => {
                    lvl.categories.forEach(cat => {
                        allWords.push(...cat.words);
                    });
                });

                const distractors = allWords.filter(w => w.en !== correctWord.en);
                const shuffledDistractors = distractors.sort(() => 0.5 - Math.random()).slice(0, 2);
                const options = [correctWord, ...shuffledDistractors].sort(() => 0.5 - Math.random());
                setQuizOptions(options);
            };

            const handleQuizAnswer = (selectedWord) => {
                const isCorrect = selectedWord.en === currentWord.en;
                if (isCorrect) {
                    setQuizFeedback('correct');
                    speak('Good job!');
                    setScore(score + 10);
                    updateProgress(currentWord.en, true);
                    setTimeout(() => {
                        setQuizFeedback(null);
                        nextCard();
                    }, 1500);
                } else {
                    setQuizFeedback('incorrect');
                    speak('Try again');
                    updateProgress(currentWord.en, false);
                    setTimeout(() => {
                        setQuizFeedback(null);
                    }, 1000);
                }
            };

            const nextCard = () => {
                setSpeakFeedback(null); 
                setRecognizedText('');
                if (currentIndex < activeWords.length - 1) {
                    const nextIndex = currentIndex + 1;
                    setCurrentIndex(nextIndex);
                    if (screen === 'quiz') {
                        generateQuizOptions(activeWords[nextIndex]);
                    }
                } else {
                    setScreen('result');
                    speak('Congratulations! You finished!');
                }
            };

            const prevCard = () => {
                setSpeakFeedback(null);
                setRecognizedText('');
                if (currentIndex > 0) {
                    const prevIndex = currentIndex - 1;
                    setCurrentIndex(prevIndex);
                    if (screen === 'quiz') {
                        generateQuizOptions(activeWords[prevIndex]);
                    }
                }
            };

            const startQuizMode = () => {
                setCurrentIndex(0);
                setScore(0);
                setScreen('quiz');
                if (activeWords.length > 0) {
                    generateQuizOptions(activeWords[0]);
                }
            };

            // --- Áï´Èù¢Ê∏≤Êüì ---

            if (screen === 'home') {
                return (
                    <div className="h-[100dvh] w-full bg-slate-50 flex flex-col max-w-md mx-auto shadow-xl overflow-hidden">
                        {/* Header Area with Level Info */}
                        <header className="bg-orange-100 p-6 rounded-b-3xl shadow-sm shrink-0">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-orange-600">Ê®ÇÈΩ°Ëã±Ë™û</h1>
                                    <p className="text-sm text-gray-600">ÊØèÂ§©‰∏ÄÈªûÈªûÔºåÂ§ßËÖ¶Êõ¥ÈùàÊ¥ª</p>
                                </div>
                                <div className="text-center bg-white p-2 rounded-xl shadow-sm border border-orange-200">
                                    <div className="text-4xl">{userLevelInfo.badge}</div>
                                    <div className="text-xs font-bold text-orange-800 mt-1">{userLevelInfo.badgeName}</div>
                                </div>
                            </div>
                            
                            {/* Level Progress Bar */}
                            <div className="bg-white rounded-full h-4 w-full overflow-hidden border border-orange-200">
                                {/* ÂÅáË®≠ÊúÄÈ´òÁõÆÊ®ôÊòØ300Â≠ó */}
                                <div className="bg-orange-400 h-full transition-all duration-1000" style={{width: `${Math.min((userLevelInfo.masteredCount / 300) * 100, 100)}%`}}></div>
                            </div>
                            <div className="text-right text-xs text-gray-500 mt-1">
                                Â∑≤ÁÜüÁ∑¥ {userLevelInfo.masteredCount} ÂÄãÂñÆÂ≠ó
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 pb-20 scrollbar-hide">
                            <button onClick={startReview} className="w-full bg-green-500 hover:bg-green-600 text-white rounded-2xl p-4 mb-6 shadow-md transition-all btn-press flex items-center justify-between">
                                <div className="flex items-center">
                                    <div className="bg-white/20 p-2 rounded-full mr-3"><Icon name="refresh" size={24} /></div>
                                    <div className="text-left">
                                        <div className="text-xl font-bold">Ë§áÁøíÂº±È†Ö</div>
                                        <div className="text-xs opacity-90">Âä†Âº∑‰∏çÁÜüÁöÑÂñÆÂ≠ó</div>
                                    </div>
                                </div>
                                <Icon name="arrowRight" />
                            </button>

                            {/* Level Categories */}
                            <div className="space-y-6">
                                {levelsData.map((lvl) => (
                                    <div key={lvl.level} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                                        <div className="flex items-center justify-between mb-3 border-b border-gray-100 pb-2">
                                            <div className="flex items-center">
                                                <span className="text-2xl mr-2">{lvl.badge}</span>
                                                <div>
                                                    <h3 className="font-bold text-lg text-slate-800">{lvl.title}</h3>
                                                    <p className="text-xs text-gray-500">{lvl.desc}</p>
                                                </div>
                                            </div>
                                            {lvl.level > userLevelInfo.level + 1 && <Icon name="lock" className="text-gray-300" />}
                                        </div>
                                        <div className="grid grid-cols-1 gap-2">
                                            {lvl.categories.map(cat => (
                                                <button 
                                                    key={cat.id}
                                                    onClick={() => startCategory(cat)}
                                                    className="w-full text-left bg-slate-50 hover:bg-orange-50 p-3 rounded-xl transition-colors flex justify-between items-center group"
                                                >
                                                    <span className="text-slate-700 font-medium group-hover:text-orange-700">{cat.title}</span>
                                                    <span className="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full group-hover:bg-orange-200 group-hover:text-orange-800">{cat.words.length}Â≠ó</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // ÂÆâÂÖ®Ê™¢Êü•
            if (!currentWord && screen !== 'home' && screen !== 'result') {
                 setTimeout(() => setScreen('home'), 0);
                 return null;
            }

            if (screen === 'learn') {
                return (
                    <div className="h-[100dvh] w-full bg-blue-50 flex flex-col max-w-md mx-auto shadow-xl relative overflow-hidden">
                        <div className="shrink-0 flex justify-between items-center p-4 bg-white shadow-sm z-10">
                            <button onClick={() => setScreen('home')} className="text-gray-600 p-2"><Icon name="home" /></button>
                            <div className="flex flex-col items-center">
                                <span className="text-sm text-gray-500">{activeCategory ? activeCategory.title : 'Â≠∏Áøí‰∏≠'}</span>
                                <span className="text-lg font-bold text-blue-600">{currentIndex + 1} / {activeWords.length}</span>
                            </div>
                            <button onClick={() => setShowVoiceModal(true)} className="text-gray-600 p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                                <Icon name="settings" size={24} />
                            </button>
                        </div>

                        <div className="flex-1 flex flex-col items-center p-4 text-center overflow-y-auto scrollbar-hide">
                            <div className="bg-white w-full rounded-3xl shadow-lg p-5 mb-4 border-b-4 border-blue-200">
                                <h2 className={`${currentWord.en.length > 10 ? 'text-4xl' : 'text-5xl'} font-bold text-slate-800 mb-2 tracking-wide break-words`}>{currentWord.en}</h2>
                                <div className="text-xl text-gray-500 font-mono mb-2">/{currentWord.ipa}/</div>
                                <div className="text-2xl text-orange-600 font-bold mb-4">{currentWord.zh}</div>
                                
                                <div className="flex justify-center gap-2 mb-4">
                                    <button onClick={() => setSpeechRate(1.0)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 1.0 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>Ê≠£Â∏∏</button>
                                    <button onClick={() => setSpeechRate(0.6)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 0.6 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>ÊÖ¢ (60%)</button>
                                    <button onClick={() => setSpeechRate(0.1)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 0.1 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>Ê•µÊÖ¢ (10%)</button>
                                </div>

                                <div className="bg-gray-100 inline-block px-4 py-2 rounded-full text-lg text-gray-600 mb-6">ÁôºÈü≥ÂÉèÔºö{currentWord.pronunciation}</div>
                                
                                <button onClick={() => speak(currentWord.en)} className="bg-blue-500 text-white w-full rounded-xl p-3 shadow-md mb-4 active:scale-95 transition-transform flex items-center justify-center gap-2">
                                    <Icon name="volume" size={24} />
                                    <span className="text-xl font-bold">ËÅΩÂñÆÂ≠ó</span>
                                </button>

                                <div className="border-t pt-4">
                                    <p className="text-lg text-gray-500 mb-1">‰æãÂè•Ôºö</p>
                                    <div className="flex items-center justify-center gap-2">
                                        <p className="text-lg text-slate-700 font-medium text-left flex-1">{currentWord.sentence}</p>
                                        <button onClick={() => speak(currentWord.sentence)} className="bg-blue-100 text-blue-600 p-3 rounded-full hover:bg-blue-200">
                                            <Icon name="volume" size={20} />
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="w-full bg-indigo-50 rounded-2xl p-4 border-2 border-indigo-100">
                                <div className="text-lg font-bold text-indigo-800 mb-2">Âè£Ë™™Á∑¥Áøí</div>
                                <div className="flex flex-col items-center">
                                    <button 
                                        onClick={startListening}
                                        disabled={isListening}
                                        className={`w-20 h-20 rounded-full flex items-center justify-center shadow-lg transition-all ${isListening ? 'bg-red-500 pulse-animation' : 'bg-white border-4 border-indigo-200 text-indigo-500'}`}
                                    >
                                        <Icon name="mic" size={40} className={isListening ? 'text-white' : ''} />
                                    </button>
                                    <div className="mt-2 h-8">
                                        {isListening && <span className="text-red-500 font-bold animate-pulse">Ë´ãÂ§ßËÅ≤Âî∏Âá∫‰æÜ...</span>}
                                        {!isListening && !speakFeedback && <span className="text-gray-400 text-sm">ÈªûÊìäÈ∫•ÂÖãÈ¢®ÈñãÂßãÈåÑÈü≥</span>}
                                        {!isListening && speakFeedback === 'match' && <span className="text-green-600 font-bold text-lg">Â§™Ê£í‰∫ÜÔºÅÂî∏Â∞ç‰∫ÜÔºÅüéâ</span>}
                                        {!isListening && speakFeedback === 'no-match' && (
                                            <div className="text-orange-500 font-bold">
                                                <span>ÂÜçË©¶‰∏ÄÊ¨°ÂñîÔºÅ</span>
                                                <div className="text-xs text-gray-400 font-normal">ËÅΩÂà∞Ôºö{recognizedText}</div>
                                            </div>
                                        )}
                                        {!isListening && speakFeedback === 'error' && <span className="text-red-400 text-sm">ÁÑ°Ê≥ï‰ΩøÁî®È∫•ÂÖãÈ¢®</span>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="shrink-0 p-4 bg-white flex justify-between gap-4 border-t z-10">
                            <button onClick={prevCard} disabled={currentIndex === 0} className={`flex-1 py-4 rounded-xl text-xl font-bold ${currentIndex === 0 ? 'bg-gray-100 text-gray-300' : 'bg-gray-200 text-gray-700'}`}>‰∏ä‰∏ÄÂÄã</button>
                            {currentIndex === activeWords.length - 1 ? (
                                <button onClick={startQuizMode} className="flex-1 bg-orange-500 text-white py-4 rounded-xl text-xl font-bold shadow-md btn-press">ÈñãÂßãÊ∏¨È©ó</button>
                            ) : (
                                <button onClick={nextCard} className="flex-1 bg-blue-600 text-white py-4 rounded-xl text-xl font-bold shadow-md btn-press">‰∏ã‰∏ÄÂÄã</button>
                            )}
                        </div>

                        {showVoiceModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-2xl w-full max-w-sm max-h-[80vh] flex flex-col shadow-2xl">
                                    <div className="p-4 border-b flex justify-between items-center">
                                        <h3 className="text-xl font-bold text-slate-800">ÈÅ∏ÊìáÁôºÈü≥‰∫∫</h3>
                                        <button onClick={() => setShowVoiceModal(false)} className="text-gray-500 hover:text-gray-700"><Icon name="x" size={24} /></button>
                                    </div>
                                    <div className="p-4 bg-blue-50 text-sm text-blue-800 rounded-lg mx-4 mt-2 mb-2">
                                        <strong>üí° Ë¶∫ÂæóËÅ≤Èü≥ÂÉèÊ©üÂô®‰∫∫Ôºü</strong>
                                        <ul className="list-disc pl-4 mt-1 space-y-1">
                                            <li><strong>iPhone:</strong> Ë®≠ÂÆö > ËºîÂä©‰ΩøÁî® > Ë™ûÈü≥ÂÖßÂÆπ > ‰∏ãËºâ Siri/Â¢ûÂº∑ÁâàËÅ≤Èü≥„ÄÇ</li>
                                            <li><strong>Android:</strong> Ë®≠ÂÆö > ÊñáÂ≠óËΩâË™ûÈü≥ > Êõ¥Êñ∞ Google Ë™ûÈü≥ÊúçÂãô„ÄÇ</li>
                                            <li>(Ê≥®ÊÑèÔºöiPhone ÊúâÊôÇÊúÉÂõ†ÁÇ∫Á≥ªÁµ±ÈôêÂà∂ÔºåÈö±ËóèÈÉ®ÂàÜ Siri ËÅ≤Èü≥Ôºå‰ΩÜÂ¢ûÂº∑ÁâàËÅ≤Èü≥ÈÄöÂ∏∏ÊúÉÂá∫Áèæ)</li>
                                        </ul>
                                    </div>
                                    <div className="p-2 overflow-y-auto flex-1">
                                        {availableVoices.length === 0 ? <div className="text-center p-4 text-gray-500">Êâæ‰∏çÂà∞ÂèØÁî®ÁöÑËã±ÊñáË™ûÈü≥</div> : 
                                            availableVoices.map((voice, idx) => {
                                                const nameLower = voice.name.toLowerCase();
                                                const isHighQuality = nameLower.includes('siri') || nameLower.includes('enhanced') || nameLower.includes('premium') || nameLower.includes('google') || nameLower.includes('natural');
                                                return (
                                                    <button key={idx} onClick={() => selectVoiceAndTest(voice)} className={`w-full text-left p-4 rounded-xl mb-2 flex items-center justify-between border-2 transition-all ${selectedVoice && selectedVoice.name === voice.name ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-gray-100 hover:border-blue-200'}`}>
                                                        <div>
                                                            <div className="font-bold text-lg flex items-center">
                                                                ËÅ≤Èü≥ {idx + 1}
                                                                {isHighQuality && <span className="ml-2 text-xs bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full border border-orange-200">üëç Êé®Ëñ¶Èü≥Ë≥™</span>}
                                                            </div>
                                                            <div className="text-xs text-gray-400 truncate w-48">{voice.name}</div>
                                                        </div>
                                                        {selectedVoice && selectedVoice.name === voice.name && <Icon name="check" className="text-blue-500" />}
                                                    </button>
                                                );
                                            })
                                        }
                                    </div>
                                    <div className="p-4 border-t">
                                        <button onClick={() => setShowVoiceModal(false)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-lg shadow-md">Á¢∫ÂÆö</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (screen === 'quiz') {
                return (
                    <div className="h-[100dvh] w-full bg-indigo-50 flex flex-col max-w-md mx-auto shadow-xl overflow-hidden">
                        <div className="shrink-0 p-4 text-center">
                            <div className="text-2xl font-bold text-indigo-800">Â∞èÊ∏¨È©ó</div>
                            <div className="text-gray-500">ÈÅ∏Âá∫Ê≠£Á¢∫ÁöÑ‰∏≠ÊñáÊÑèÊÄù</div>
                        </div>
                        <div className="flex-1 flex flex-col items-center p-6 overflow-y-auto scrollbar-hide">
                            <div className="bg-white w-full rounded-2xl shadow-md p-8 mb-8 text-center relative overflow-hidden shrink-0">
                                {quizFeedback === 'correct' && <div className="absolute inset-0 bg-green-100 flex items-center justify-center z-10"><div className="text-green-600 font-bold text-4xl flex flex-col items-center"><Icon name="check" size={64} /><div>Á≠îÂ∞ç‰∫ÜÔºÅ</div></div></div>}
                                {quizFeedback === 'incorrect' && <div className="absolute inset-0 bg-red-100 flex items-center justify-center z-10"><div className="text-red-500 font-bold text-4xl flex flex-col items-center"><Icon name="x" size={64} /><div>ÂÜçË©¶‰∏ÄÊ¨°</div></div></div>}
                                <div className={`${currentWord.en.length > 10 ? 'text-4xl' : 'text-5xl'} font-bold text-slate-800 mb-4 break-words`}>{currentWord.en}</div>
                                <button onClick={() => speak(currentWord.en)} className="text-blue-500 mx-auto block p-2"><Icon name="volume" size={32} /></button>
                            </div>
                            <div className="w-full space-y-4 pb-4">
                                {quizOptions.map((option, idx) => (
                                    <button key={idx} onClick={() => handleQuizAnswer(option)} className="w-full bg-white hover:bg-indigo-100 border-2 border-indigo-100 rounded-xl p-6 text-2xl font-bold text-slate-700 shadow-sm btn-press transition-colors">{option.zh}</button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'result') {
                return (
                    <div className="h-[100dvh] w-full bg-yellow-50 flex flex-col items-center justify-center max-w-md mx-auto p-6 text-center overflow-hidden">
                        <div className="bg-white p-8 rounded-3xl shadow-xl w-full">
                            <div className="text-yellow-500 flex justify-center mb-4"><Icon name="star" size={80} className="fill-current" /></div>
                            <h2 className="text-4xl font-bold text-slate-800 mb-4">ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
                            <p className="text-xl text-gray-600 mb-8">‰ªäÂ§©ÁöÑÂ§ßËÖ¶ÈÅãÂãïÂÅöÂæóÂæàÊ£íÂñîÔºÅ</p>
                            <div className="space-y-4">
                                <button onClick={() => setScreen('home')} className="w-full bg-orange-500 text-white text-2xl font-bold py-4 rounded-xl shadow-md btn-press">ÂõûÈ¶ñÈ†Å</button>
                                <button onClick={() => startCategory(activeCategory)} className="w-full bg-white border-2 border-orange-200 text-orange-600 text-xl font-bold py-4 rounded-xl btn-press">ÂÜçÁ∑¥Áøí‰∏ÄÊ¨°</button>
                            </div>
                        </div>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
