<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¨‚é½¡è‹±èªå°å­¸å ‚</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; touch-action: manipulation; overscroll-behavior: none; }
        .btn-press:active { transform: scale(0.95); }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        .pulse-animation { animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- è³‡æ–™åº« (5ç´šåˆ¶èª²ç¨‹å…§å®¹) ---
        const levelsData = [
            {
                level: 1,
                title: "ç­‰ç´š 1ï¼šåŸºç¤å…¥é–€",
                badge: "ğŸŒ±",
                badgeName: "æ–°æ‰‹ç¨®å­",
                desc: "æŒæ¡æ™‚é–“ã€æ•¸å­—èˆ‡å¤©æ°£",
                categories: [
                    {
                        id: 'l1_basics', title: 'æ•¸å­—èˆ‡å•å€™', words: [
                            { en: 'One', ipa: 'wÊŒn', zh: 'ä¸€', pronunciation: 'è¬', sentence: 'One apple.' },
                            { en: 'Two', ipa: 'tuË', zh: 'äºŒ', pronunciation: 'å…”', sentence: 'Two cats.' },
                            { en: 'Three', ipa: 'Î¸riË', zh: 'ä¸‰', pronunciation: 'æ­²', sentence: 'Three o\'clock.' },
                            { en: 'Four', ipa: 'fÉ”Ër', zh: 'å››', pronunciation: 'ä½›', sentence: 'Four seasons.' },
                            { en: 'Five', ipa: 'faÉªv', zh: 'äº”', pronunciation: 'æ³•å¤«', sentence: 'High five!' },
                            { en: 'Ten', ipa: 'tÉ›n', zh: 'å', pronunciation: 'å¤©', sentence: 'Count to ten.' },
                            { en: 'Hello', ipa: 'hÉ™ËˆloÊŠ', zh: 'ä½ å¥½', pronunciation: 'å“ˆ-å›‰', sentence: 'Hello, my friend.' },
                            { en: 'Thank you', ipa: 'Î¸Ã¦Å‹k juË', zh: 'è¬è¬', pronunciation: 'ä¸‰-Q', sentence: 'Thank you very much.' },
                        ]
                    },
                    {
                        id: 'l1_time', title: 'æ™‚é–“èˆ‡æ˜ŸæœŸ', words: [
                            { en: 'Monday', ipa: 'ËˆmÊŒndeÉª', zh: 'æ˜ŸæœŸä¸€', pronunciation: 'æ›¼-day', sentence: 'Today is Monday.' },
                            { en: 'Sunday', ipa: 'ËˆsÊŒndeÉª', zh: 'æ˜ŸæœŸæ—¥', pronunciation: 'çŠ-day', sentence: 'Sunday is a holiday.' },
                            { en: 'Morning', ipa: 'ËˆmÉ”ËrnÉªÅ‹', zh: 'æ—©ä¸Š', pronunciation: 'æ‘©-å¯§', sentence: 'Good morning.' },
                            { en: 'Night', ipa: 'naÉªt', zh: 'æ™šä¸Š', pronunciation: 'å¥ˆ-ç‰¹', sentence: 'Good night.' },
                            { en: 'Today', ipa: 'tÉ™ËˆdeÉª', zh: 'ä»Šå¤©', pronunciation: 'åœŸ-day', sentence: 'How are you today?' },
                            { en: 'Tomorrow', ipa: 'tÉ™ËˆmÉ”ËroÊŠ', zh: 'æ˜å¤©', pronunciation: 'åœŸ-æ‘©-æŸ”', sentence: 'See you tomorrow.' },
                        ]
                    },
                    {
                        id: 'l1_months', title: 'æœˆä»½èˆ‡å¤©æ°£', words: [
                            { en: 'January', ipa: 'ËˆdÊ’Ã¦njuÉ™ri', zh: 'ä¸€æœˆ', pronunciation: 'é–“-ç‰›-çˆ¾ç‘', sentence: 'January is cold.' },
                            { en: 'May', ipa: 'meÉª', zh: 'äº”æœˆ', pronunciation: 'æ¢…', sentence: 'May is spring.' },
                            { en: 'August', ipa: 'ËˆÉ”ËÉ¡É™st', zh: 'å…«æœˆ', pronunciation: 'å¥§-è‘›-æ­»ç‰¹', sentence: 'August is hot.' },
                            { en: 'December', ipa: 'dÉªËˆsÉ›mbÉ™r', zh: 'åäºŒæœˆ', pronunciation: 'ä½-æ£®-æŸ', sentence: 'Christmas is in December.' },
                            { en: 'Sunny', ipa: 'ËˆsÊŒni', zh: 'æ™´å¤©', pronunciation: 'æ¡‘-æ³¥', sentence: 'It is sunny today.' },
                            { en: 'Rainy', ipa: 'ËˆreÉªni', zh: 'é›¨å¤©', pronunciation: 'ç‘-æ³¥', sentence: 'It is rainy outside.' },
                            { en: 'Cold', ipa: 'koÊŠld', zh: 'å†·', pronunciation: 'å¯‡-å¾—', sentence: 'It is very cold.' },
                            { en: 'Hot', ipa: 'hÉ’t', zh: 'ç†±', pronunciation: 'å“ˆ-ç‰¹', sentence: 'Be careful, it is hot.' },
                        ]
                    },
                    {
                        id: 'l1_big_nums', title: 'é€²éšæ•¸å­—', words: [
                            { en: 'Hundred', ipa: 'ËˆhÊŒndrÉ™d', zh: 'ç™¾', pronunciation: 'æ­-çˆµ-å¾—', sentence: 'One hundred dollars.' },
                            { en: 'Thousand', ipa: 'ËˆÎ¸aÊŠzÉ™nd', zh: 'åƒ', pronunciation: 'é¨·-å¿-å¾—', sentence: 'One thousand years.' },
                            { en: '263', ipa: 'tuË hÊŒndrÉ™d sÉªksti Î¸riË', zh: '263', pronunciation: 'å…”-æ­-çˆµ-å…­-è¸¢-æ­²', sentence: 'Room 263.' },
                            { en: '21,345', ipa: 'twÉ›nti wÊŒn Î¸aÊŠzÉ™nd...', zh: '21,345', pronunciation: '...', sentence: 'That is a big number.' },
                        ]
                    }
                ]
            },
            {
                level: 2,
                title: "ç­‰ç´š 2ï¼šç”Ÿæ´»åŸºç¤",
                badge: "ğŸŒ¿",
                badgeName: "èŒå£¯å«©è‘‰",
                desc: "å®¶åº­ã€èº«é«”èˆ‡é¡è‰² (ç›®æ¨™120å­—)",
                categories: [
                    {
                        id: 'l2_family', title: 'å®¶åº­æˆå“¡', words: [
                            { en: 'Father', ipa: 'ËˆfÉ‘ËÃ°É™r', zh: 'çˆ¶è¦ª', pronunciation: 'æ³•-å¾—', sentence: 'My father is tall.' },
                            { en: 'Mother', ipa: 'ËˆmÊŒÃ°É™r', zh: 'æ¯è¦ª', pronunciation: 'åª½-å¾—', sentence: 'I love my mother.' },
                            { en: 'Son', ipa: 'sÊŒn', zh: 'å…’å­', pronunciation: 'æ¡‘', sentence: 'He is my son.' },
                            { en: 'Daughter', ipa: 'ËˆdÉ”ËtÉ™r', zh: 'å¥³å…’', pronunciation: 'å¤š-ç‰¹', sentence: 'She is my daughter.' },
                            { en: 'Grandma', ipa: 'ËˆÉ¡rÃ¦nmÉ‘Ë', zh: 'å¥¶å¥¶/å¤–å©†', pronunciation: 'è‘›ç‘-åª½', sentence: 'Grandma is cooking.' },
                            { en: 'Friend', ipa: 'frÉ›nd', zh: 'æœ‹å‹', pronunciation: 'å¤«ç‘-æ©-å¾—', sentence: 'He is my best friend.' },
                        ]
                    },
                    {
                        id: 'l2_body', title: 'èº«é«”éƒ¨ä½', words: [
                            { en: 'Head', ipa: 'hÉ›d', zh: 'é ­', pronunciation: 'é»‘-å¾—', sentence: 'Nod your head.' },
                            { en: 'Hand', ipa: 'hÃ¦nd', zh: 'æ‰‹', pronunciation: 'æ¼¢-å¾—', sentence: 'Wash your hands.' },
                            { en: 'Foot', ipa: 'fÊŠt', zh: 'è…³', pronunciation: 'å¯Œ-ç‰¹', sentence: 'My foot hurts.' },
                            { en: 'Eye', ipa: 'aÉª', zh: 'çœ¼ç›', pronunciation: 'æ„›', sentence: 'Close your eyes.' },
                            { en: 'Mouth', ipa: 'maÊŠÎ¸', zh: 'å˜´å·´', pronunciation: 'èŒ‚-æ€', sentence: 'Open your mouth.' },
                        ]
                    },
                    {
                        id: 'l2_colors', title: 'é¡è‰²', words: [
                            { en: 'Red', ipa: 'rÉ›d', zh: 'ç´…è‰²', pronunciation: 'ç‘-å¾—', sentence: 'A red apple.' },
                            { en: 'Blue', ipa: 'bluË', zh: 'è—è‰²', pronunciation: 'å¸ƒé­¯', sentence: 'The sky is blue.' },
                            { en: 'Green', ipa: 'É¡riËn', zh: 'ç¶ è‰²', pronunciation: 'è‘›ç‘-æ©', sentence: 'Green tea.' },
                            { en: 'White', ipa: 'waÉªt', zh: 'ç™½è‰²', pronunciation: 'å£-ç‰¹', sentence: 'White snow.' },
                            { en: 'Black', ipa: 'blÃ¦k', zh: 'é»‘è‰²', pronunciation: 'å¸ƒèŠ-å…‹', sentence: 'Black coffee.' },
                        ]
                    }
                ]
            },
            {
                level: 3,
                title: "ç­‰ç´š 3ï¼šæ—¥å¸¸äº‹ç‰©",
                badge: "ğŸŒ³",
                badgeName: "ç©©å›ºå°æ¨¹",
                desc: "é£Ÿç‰©ã€å±…å®¶èˆ‡å‹•ä½œ (ç›®æ¨™180å­—)",
                categories: [
                    {
                        id: 'l3_food', title: 'é£Ÿç‰©èˆ‡æ°´æœ', words: [
                            { en: 'Water', ipa: 'ËˆwÉ”ËtÉ™r', zh: 'æ°´', pronunciation: 'æ²ƒ-ç‰¹', sentence: 'Drink some water.' },
                            { en: 'Rice', ipa: 'raÉªs', zh: 'ç±³é£¯', pronunciation: 'ç‘-æ­»', sentence: 'I eat rice.' },
                            { en: 'Noodles', ipa: 'ËˆnuËdlz', zh: 'éºµ', pronunciation: 'æ€’-è±†-æ­»', sentence: 'Beef noodles.' },
                            { en: 'Apple', ipa: 'ËˆÃ¦pl', zh: 'è˜‹æœ', pronunciation: 'æ„›-å‰–', sentence: 'An apple a day.' },
                            { en: 'Banana', ipa: 'bÉ™ËˆnÃ¦nÉ™', zh: 'é¦™è•‰', pronunciation: 'å·´-é‚£-é‚£', sentence: 'Yellow banana.' },
                            { en: 'Tea', ipa: 'tiË', zh: 'èŒ¶', pronunciation: 'è¸¢', sentence: 'Hot tea.' },
                        ]
                    },
                    {
                        id: 'l3_home', title: 'å±…å®¶èˆ‡ç‰©å“', words: [
                            { en: 'Table', ipa: 'ËˆteÉªbl', zh: 'æ¡Œå­', pronunciation: 'æ¨-å‰–', sentence: 'On the table.' },
                            { en: 'Chair', ipa: 'tÊƒÉ›r', zh: 'æ¤…å­', pronunciation: 'å»-çˆ¾', sentence: 'Sit on the chair.' },
                            { en: 'Phone', ipa: 'foÊŠn', zh: 'é›»è©±/æ‰‹æ©Ÿ', pronunciation: 'é³³', sentence: 'Where is my phone?' },
                            { en: 'Key', ipa: 'kiË', zh: 'é‘°åŒ™', pronunciation: 'Ki', sentence: 'Car keys.' },
                            { en: 'Bag', ipa: 'bÃ¦É¡', zh: 'åŒ…åŒ…', pronunciation: 'æ‹œ-æ ¼', sentence: 'My bag is heavy.' },
                        ]
                    },
                    {
                        id: 'l3_verbs', title: 'å¸¸ç”¨å‹•ä½œ', words: [
                            { en: 'Eat', ipa: 'iËt', zh: 'åƒ', pronunciation: 'ä¸€-ç‰¹', sentence: 'Eat dinner.' },
                            { en: 'Drink', ipa: 'drÉªÅ‹k', zh: 'å–', pronunciation: 'å‡-å…‹', sentence: 'Drink water.' },
                            { en: 'Sleep', ipa: 'sliËp', zh: 'ç¡è¦º', pronunciation: 'æ­»-åŠ›-æ™®', sentence: 'Go to sleep.' },
                            { en: 'Walk', ipa: 'wÉ”Ëk', zh: 'èµ°è·¯', pronunciation: 'æ²ƒ-å…‹', sentence: 'Walk in the park.' },
                            { en: 'Go', ipa: 'É¡oÊŠ', zh: 'å»', pronunciation: 'å¤ ', sentence: 'Let\'s go.' },
                        ]
                    }
                ]
            },
            {
                level: 4,
                title: "ç­‰ç´š 4ï¼šè¡Œå‹•èˆ‡æ„Ÿå—",
                badge: "ğŸŒº",
                badgeName: "ç››é–‹èŠ±æœµ",
                desc: "äº¤é€šã€å ´æ‰€èˆ‡æ„Ÿè¦º (ç›®æ¨™240å­—)",
                categories: [
                    {
                        id: 'l4_places', title: 'å ´æ‰€èˆ‡äº¤é€š', words: [
                            { en: 'Toilet', ipa: 'ËˆtÉ”ÉªlÉªt', zh: 'å»æ‰€', pronunciation: 'å·-ä¸€-å‹’-ç‰¹', sentence: 'Where is the toilet?' },
                            { en: 'Hospital', ipa: 'ËˆhÉ’spÉªtl', zh: 'é†«é™¢', pronunciation: 'å“ˆ-æ­»-çš®-å·', sentence: 'Go to the hospital.' },
                            { en: 'Park', ipa: 'pÉ‘Ërk', zh: 'å…¬åœ’', pronunciation: 'å¸•-å…‹', sentence: 'Let\'s walk in the park.' },
                            { en: 'Bus', ipa: 'bÊŒs', zh: 'å…¬è»Š', pronunciation: 'å·´-æ­»', sentence: 'Take the bus.' },
                            { en: 'Train', ipa: 'treÉªn', zh: 'ç«è»Š', pronunciation: 'å¹-æ©', sentence: 'Train station.' },
                            { en: 'Home', ipa: 'hoÊŠm', zh: 'å®¶', pronunciation: 'è½Ÿ', sentence: 'Go home.' },
                        ]
                    },
                    {
                        id: 'l4_feelings', title: 'æ„Ÿè¦ºèˆ‡ç‹€æ…‹', words: [
                            { en: 'Happy', ipa: 'ËˆhÃ¦pi', zh: 'å¿«æ¨‚', pronunciation: 'é»‘-çš®', sentence: 'I am so happy.' },
                            { en: 'Hungry', ipa: 'ËˆhÊŒÅ‹É¡ri', zh: 'é¤“', pronunciation: 'å¤¯-è‘›ç‘', sentence: 'Are you hungry?' },
                            { en: 'Tired', ipa: 'ËˆtaÉªÉ™rd', zh: 'ç´¯', pronunciation: 'å¤ª-çˆ¾-å¾—', sentence: 'I am tired.' },
                            { en: 'Good', ipa: 'É¡ÊŠd', zh: 'å¥½', pronunciation: 'é¡§-å¾—', sentence: 'Very good!' },
                            { en: 'Beautiful', ipa: 'ËˆbjuËtÉªfl', zh: 'ç¾éº—', pronunciation: 'æ¯”-å°¤-æ-ä½›', sentence: 'Beautiful flower.' },
                        ]
                    }
                ]
            },
            {
                level: 5,
                title: "ç­‰ç´š 5ï¼šè‹±èªé”äºº",
                badge: "ğŸ‘‘",
                badgeName: "æ¦®è€€çš‡å† ",
                desc: "æ—…éŠã€è³¼ç‰©èˆ‡å¯¦ç”¨å¥ (ç›®æ¨™300å­—)",
                categories: [
                    {
                        id: 'l5_shopping', title: 'è³¼ç‰©èˆ‡éŒ¢', words: [
                            { en: 'How much', ipa: 'haÊŠ mÊŒtÊƒ', zh: 'å¤šå°‘éŒ¢', pronunciation: 'è±ª-éº»-å»', sentence: 'How much is this?' },
                            { en: 'Expensive', ipa: 'ÉªkËˆspÉ›nsÉªv', zh: 'è²´', pronunciation: 'ä¸€-å¯-æ­»-å™´-å¸Œ-å¤«', sentence: 'Too expensive.' },
                            { en: 'Cheap', ipa: 'tÊƒiËp', zh: 'ä¾¿å®œ', pronunciation: 'æ°£-æ™®', sentence: 'It is cheap.' },
                            { en: 'Buy', ipa: 'baÉª', zh: 'è²·', pronunciation: 'æ‹œ', sentence: 'I want to buy this.' },
                            { en: 'Sale', ipa: 'seÉªl', zh: 'ç‰¹åƒ¹', pronunciation: 'å¡-æ­', sentence: 'On sale.' },
                        ]
                    },
                    {
                        id: 'l5_emergency', title: 'ç·Šæ€¥èˆ‡è«‹æ±‚', words: [
                            { en: 'Help', ipa: 'hÉ›lp', zh: 'å¹«å¿™/æ•‘å‘½', pronunciation: 'é»‘-æ­-æ™®', sentence: 'Help me please.' },
                            { en: 'Doctor', ipa: 'ËˆdÉ’ktÉ™r', zh: 'é†«ç”Ÿ', pronunciation: 'é”-å…‹-ç‰¹', sentence: 'Call a doctor.' },
                            { en: 'Police', ipa: 'pÉ™ËˆliËs', zh: 'è­¦å¯Ÿ', pronunciation: 'æ³¢-éº—-æ­»', sentence: 'Call the police.' },
                            { en: 'Lost', ipa: 'lÉ”Ëst', zh: 'è¿·è·¯/éºå¤±', pronunciation: 'å‹-æ­»-ç‰¹', sentence: 'I am lost.' },
                            { en: 'Excuse me', ipa: 'ÉªkËˆskjuËz miË', zh: 'ä¸å¥½æ„æ€', pronunciation: 'ä¸€-å¯-æ­»-Q-æ­»-å¯†', sentence: 'Excuse me, where is the toilet?' },
                        ]
                    }
                ]
            }
        ];

        // --- çµ„ä»¶ï¼šåœ–æ¨™ ---
        const Icon = ({ name, size = 24, className }) => {
            const icons = {
                volume: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>,
                star: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>,
                arrowRight: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>,
                home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>,
                refresh: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></svg>,
                check: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"></polyline></svg>,
                x: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
                mic: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>,
                settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
                lock: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
            };
            return icons[name] || null;
        };

        // --- ä¸»ç¨‹å¼ ---
        const App = () => {
            const [screen, setScreen] = useState('home'); 
            const [activeCategory, setActiveCategory] = useState(null); // ç•¶å‰é¸æ“‡çš„å–®å…ƒ
            const [activeWords, setActiveWords] = useState([]); 
            const [currentIndex, setCurrentIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [userProgress, setUserProgress] = useState({}); // { wordEn: proficiencyLevel }
            const [quizOptions, setQuizOptions] = useState([]);
            const [quizFeedback, setQuizFeedback] = useState(null);
            const [speechRate, setSpeechRate] = useState(0.6); // é è¨­60%
            
            // èªéŸ³é¸æ“‡ç›¸é—œ State
            const [availableVoices, setAvailableVoices] = useState([]);
            const [selectedVoice, setSelectedVoice] = useState(null);
            const [showVoiceModal, setShowVoiceModal] = useState(false);

            // èªéŸ³è­˜åˆ¥ç›¸é—œ State
            const [isListening, setIsListening] = useState(false);
            const [speakFeedback, setSpeakFeedback] = useState(null); 
            const [recognizedText, setRecognizedText] = useState('');
            const recognitionRef = useRef(null);

            // Ref ç”¨æ–¼è§£æ±ºèªéŸ³è­˜åˆ¥ callback ä¸­çš„é–‰åŒ…å•é¡Œ
            const stateRef = useRef({ activeWords: [], currentIndex: 0 });

            useEffect(() => {
                stateRef.current = { activeWords, currentIndex };
            }, [activeWords, currentIndex]);

            // è¨ˆç®—ä½¿ç”¨è€…ç­‰ç´š
            const userLevelInfo = useMemo(() => {
                const masteredCount = Object.values(userProgress).filter(p => p >= 3).length;
                
                // ç°¡å–®çš„å‡ç´šé‚è¼¯ï¼šå­¸æœƒå¹¾å€‹å­—å°±å‡ç´š
                // Level 1: 0-20å­—, Level 2: 21-50, Level 3: 51-100, Level 4: 101-180, Level 5: 180+
                let currentLevel = 1;
                if (masteredCount > 180) currentLevel = 5;
                else if (masteredCount > 100) currentLevel = 4;
                else if (masteredCount > 50) currentLevel = 3;
                else if (masteredCount > 20) currentLevel = 2;

                // å–å¾—è©²ç­‰ç´šçš„è³‡æ–™
                const levelData = levelsData.find(l => l.level === currentLevel) || levelsData[0];
                return {
                    level: currentLevel,
                    badge: levelData.badge,
                    badgeName: levelData.badgeName,
                    masteredCount: masteredCount
                };
            }, [userProgress]);

            // åˆå§‹åŒ–èªéŸ³åˆ—è¡¨ (åŒå‰)
            useEffect(() => {
                const loadVoices = () => {
                    const allVoices = window.speechSynthesis.getVoices();
                    const enVoices = allVoices.filter(v => v.lang.startsWith('en'));
                    
                    enVoices.sort((a, b) => {
                        const isGoodA = isHighQuality(a);
                        const isGoodB = isHighQuality(b);
                        if (isGoodA && !isGoodB) return -1;
                        if (!isGoodA && isGoodB) return 1;
                        return 0;
                    });

                    setAvailableVoices(enVoices);
                    if (enVoices.length > 0 && !selectedVoice) {
                        setSelectedVoice(enVoices[0]);
                    }
                };

                const isHighQuality = (voice) => {
                    const name = voice.name.toLowerCase();
                    return name.includes('siri') || 
                           name.includes('enhanced') || 
                           name.includes('premium') || 
                           name.includes('google') ||
                           name.includes('natural');
                };

                loadVoices();
                window.speechSynthesis.onvoiceschanged = loadVoices;
            }, [selectedVoice]);

            // åˆå§‹åŒ–èªéŸ³è­˜åˆ¥ (åŒå‰)
            useEffect(() => {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognitionRef.current = new SpeechRecognition();
                    recognitionRef.current.continuous = false;
                    recognitionRef.current.lang = 'en-US';
                    recognitionRef.current.interimResults = false;

                    recognitionRef.current.onstart = () => { setIsListening(true); };

                    recognitionRef.current.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        setRecognizedText(transcript);
                        
                        const { activeWords, currentIndex } = stateRef.current;
                        if (activeWords && activeWords.length > currentIndex) {
                             const currentWord = activeWords[currentIndex];
                             const target = currentWord.en.toLowerCase();
                             const targetNum = target.replace(/,/g, ''); 
                             const spoken = transcript.toLowerCase();
                             
                             if (spoken.includes(target) || 
                                 target.includes(spoken) || 
                                 spoken.includes(targetNum) || 
                                 spoken.replace(/,/g, '') === targetNum) {
                                 setSpeakFeedback('match');
                                 speak(currentWord.en); 
                             } else {
                                 setSpeakFeedback('no-match');
                                 speak('Try again');
                             }
                        }
                        setIsListening(false);
                    };

                    recognitionRef.current.onerror = (event) => {
                        console.error('Speech error', event.error);
                        setIsListening(false);
                        if (event.error !== 'no-speech') setSpeakFeedback('error');
                    };
                    recognitionRef.current.onend = () => { setIsListening(false); };
                }
                return () => {
                    if (recognitionRef.current) {
                        try { recognitionRef.current.abort(); } catch (e) {}
                    }
                };
            }, []);

            useEffect(() => {
                const savedProgress = localStorage.getItem('englishAppProgress');
                if (savedProgress) {
                    setUserProgress(JSON.parse(savedProgress));
                }
            }, []);

            const updateProgress = (word, isCorrect) => {
                const newProgress = { ...userProgress };
                const currentScore = newProgress[word] || 0;
                if (isCorrect) {
                    newProgress[word] = Math.min(currentScore + 1, 5); 
                } else {
                    newProgress[word] = Math.max(currentScore - 1, 0);
                }
                setUserProgress(newProgress);
                localStorage.setItem('englishAppProgress', JSON.stringify(newProgress));
            };

            const speak = (text, overrideRate = null) => {
                window.speechSynthesis.cancel();
                const englishText = text.replace(/\(.*\)/, ''); 
                
                const isLongNumber = /\d{3,}/.test(englishText);
                let rateToUse = overrideRate !== null ? overrideRate : speechRate;
                if (overrideRate === null && isLongNumber && speechRate > 0.7) {
                    rateToUse = 0.7;
                }

                const utterance = new SpeechSynthesisUtterance(englishText);
                utterance.lang = 'en-US';
                if (selectedVoice) utterance.voice = selectedVoice;
                utterance.rate = rateToUse;
                window.speechSynthesis.speak(utterance);
            };

            const selectVoiceAndTest = (voice) => {
                setSelectedVoice(voice);
                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance("Hello, Rosa, How are you today?");
                    utterance.voice = voice;
                    utterance.rate = 0.8;
                    window.speechSynthesis.speak(utterance);
                }, 100);
            };

            const startListening = () => {
                if (!recognitionRef.current) {
                    alert("æŠ±æ­‰ï¼Œæ‚¨çš„æ‰‹æ©Ÿç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜åŠŸèƒ½ã€‚");
                    return;
                }
                if (isListening) {
                    recognitionRef.current.stop();
                    return;
                }
                setSpeakFeedback(null);
                setRecognizedText('');
                setIsListening(true);
                try {
                    recognitionRef.current.start();
                } catch (e) {
                    if (e.name === 'InvalidStateError' || e.message.includes('already started')) {
                        try { recognitionRef.current.stop(); } catch (err) {}
                        setIsListening(false);
                    } else {
                        setIsListening(false);
                    }
                }
            };

            const currentWord = activeWords[currentIndex];

            // å•Ÿå‹•ç‰¹å®šåˆ†é¡çš„èª²ç¨‹
            const startCategory = (category) => {
                setActiveWords(category.words);
                setActiveCategory(category);
                // é€™è£¡å·²ç¶“ç§»é™¤äº†éŒ¯èª¤çš„ setCurrentLevelId å‘¼å«
                setCurrentIndex(0);
                setSpeakFeedback(null);
                setScreen('learn');
            };

            const startReview = () => {
                // æ”¶é›†æ‰€æœ‰å–®å­—
                const allWords = [];
                levelsData.forEach(lvl => {
                    lvl.categories.forEach(cat => {
                        allWords.push(...cat.words);
                    });
                });

                const weakWords = allWords.filter(w => (userProgress[w.en] || 0) < 3);
                // å„ªå…ˆè¤‡ç¿’å¼±é …ï¼Œä¸å¤ å‰‡è£œéš¨æ©Ÿ
                let reviewWords = [];
                if (weakWords.length > 0) {
                    reviewWords = weakWords.slice(0, 15);
                } else {
                    reviewWords = allWords.sort(() => 0.5 - Math.random()).slice(0, 15);
                }
                
                // å»ºç«‹ä¸€å€‹è‡¨æ™‚çš„è¤‡ç¿’ç”¨åˆ†é¡ç‰©ä»¶
                const reviewCategory = {
                    id: 'review',
                    title: 'è¤‡ç¿’æ¨¡å¼',
                    words: reviewWords
                };
                
                startCategory(reviewCategory);
            };

            const generateQuizOptions = (correctWord) => {
                // æ”¶é›†æ‰€æœ‰å–®å­—ä½œç‚ºå¹²æ“¾é …
                const allWords = [];
                levelsData.forEach(lvl => {
                    lvl.categories.forEach(cat => {
                        allWords.push(...cat.words);
                    });
                });

                const distractors = allWords.filter(w => w.en !== correctWord.en);
                const shuffledDistractors = distractors.sort(() => 0.5 - Math.random()).slice(0, 2);
                const options = [correctWord, ...shuffledDistractors].sort(() => 0.5 - Math.random());
                setQuizOptions(options);
            };

            const handleQuizAnswer = (selectedWord) => {
                const isCorrect = selectedWord.en === currentWord.en;
                if (isCorrect) {
                    setQuizFeedback('correct');
                    speak('Good job!');
                    setScore(score + 10);
                    updateProgress(currentWord.en, true);
                    setTimeout(() => {
                        setQuizFeedback(null);
                        nextCard();
                    }, 1500);
                } else {
                    setQuizFeedback('incorrect');
                    speak('Try again');
                    updateProgress(currentWord.en, false);
                    setTimeout(() => {
                        setQuizFeedback(null);
                    }, 1000);
                }
            };

            const nextCard = () => {
                setSpeakFeedback(null); 
                setRecognizedText('');
                if (currentIndex < activeWords.length - 1) {
                    const nextIndex = currentIndex + 1;
                    setCurrentIndex(nextIndex);
                    if (screen === 'quiz') {
                        generateQuizOptions(activeWords[nextIndex]);
                    }
                } else {
                    setScreen('result');
                    speak('Congratulations! You finished!');
                }
            };

            const prevCard = () => {
                setSpeakFeedback(null);
                setRecognizedText('');
                if (currentIndex > 0) {
                    const prevIndex = currentIndex - 1;
                    setCurrentIndex(prevIndex);
                    if (screen === 'quiz') {
                        generateQuizOptions(activeWords[prevIndex]);
                    }
                }
            };

            const startQuizMode = () => {
                setCurrentIndex(0);
                setScore(0);
                setScreen('quiz');
                if (activeWords.length > 0) {
                    generateQuizOptions(activeWords[0]);
                }
            };

            // --- ç•«é¢æ¸²æŸ“ ---

            if (screen === 'home') {
                return (
                    <div className="h-[100dvh] w-full bg-slate-50 flex flex-col max-w-md mx-auto shadow-xl overflow-hidden">
                        {/* Header Area with Level Info */}
                        <header className="bg-orange-100 p-6 rounded-b-3xl shadow-sm shrink-0">
                            <div className="flex justify-between items-center mb-4">
                                <div>
                                    <h1 className="text-3xl font-bold text-orange-600">æ¨‚é½¡è‹±èª</h1>
                                    <p className="text-sm text-gray-600">æ¯å¤©ä¸€é»é»ï¼Œå¤§è…¦æ›´éˆæ´»</p>
                                </div>
                                <div className="text-center bg-white p-2 rounded-xl shadow-sm border border-orange-200">
                                    <div className="text-4xl">{userLevelInfo.badge}</div>
                                    <div className="text-xs font-bold text-orange-800 mt-1">{userLevelInfo.badgeName}</div>
                                </div>
                            </div>
                            
                            {/* Level Progress Bar */}
                            <div className="bg-white rounded-full h-4 w-full overflow-hidden border border-orange-200">
                                {/* å‡è¨­æœ€é«˜ç›®æ¨™æ˜¯300å­— */}
                                <div className="bg-orange-400 h-full transition-all duration-1000" style={{width: `${Math.min((userLevelInfo.masteredCount / 300) * 100, 100)}%`}}></div>
                            </div>
                            <div className="text-right text-xs text-gray-500 mt-1">
                                å·²ç†Ÿç·´ {userLevelInfo.masteredCount} å€‹å–®å­—
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-4 pb-20 scrollbar-hide">
                            <button onClick={startReview} className="w-full bg-green-500 hover:bg-green-600 text-white rounded-2xl p-4 mb-6 shadow-md transition-all btn-press flex items-center justify-between">
                                <div className="flex items-center">
                                    <div className="bg-white/20 p-2 rounded-full mr-3"><Icon name="refresh" size={24} /></div>
                                    <div className="text-left">
                                        <div className="text-xl font-bold">è¤‡ç¿’å¼±é …</div>
                                        <div className="text-xs opacity-90">åŠ å¼·ä¸ç†Ÿçš„å–®å­—</div>
                                    </div>
                                </div>
                                <Icon name="arrowRight" />
                            </button>

                            {/* Level Categories */}
                            <div className="space-y-6">
                                {levelsData.map((lvl) => (
                                    <div key={lvl.level} className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                                        <div className="flex items-center justify-between mb-3 border-b border-gray-100 pb-2">
                                            <div className="flex items-center">
                                                <span className="text-2xl mr-2">{lvl.badge}</span>
                                                <div>
                                                    <h3 className="font-bold text-lg text-slate-800">{lvl.title}</h3>
                                                    <p className="text-xs text-gray-500">{lvl.desc}</p>
                                                </div>
                                            </div>
                                            {lvl.level > userLevelInfo.level + 1 && <Icon name="lock" className="text-gray-300" />}
                                        </div>
                                        <div className="grid grid-cols-1 gap-2">
                                            {lvl.categories.map(cat => (
                                                <button 
                                                    key={cat.id}
                                                    onClick={() => startCategory(cat)}
                                                    className="w-full text-left bg-slate-50 hover:bg-orange-50 p-3 rounded-xl transition-colors flex justify-between items-center group"
                                                >
                                                    <span className="text-slate-700 font-medium group-hover:text-orange-700">{cat.title}</span>
                                                    <span className="text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full group-hover:bg-orange-200 group-hover:text-orange-800">{cat.words.length}å­—</span>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            // å®‰å…¨æª¢æŸ¥
            if (!currentWord && screen !== 'home' && screen !== 'result') {
                 setTimeout(() => setScreen('home'), 0);
                 return null;
            }

            if (screen === 'learn') {
                return (
                    <div className="h-[100dvh] w-full bg-blue-50 flex flex-col max-w-md mx-auto shadow-xl relative overflow-hidden">
                        <div className="shrink-0 flex justify-between items-center p-4 bg-white shadow-sm z-10">
                            <button onClick={() => setScreen('home')} className="text-gray-600 p-2"><Icon name="home" /></button>
                            <div className="flex flex-col items-center">
                                <span className="text-sm text-gray-500">{activeCategory ? activeCategory.title : 'å­¸ç¿’ä¸­'}</span>
                                <span className="text-lg font-bold text-blue-600">{currentIndex + 1} / {activeWords.length}</span>
                            </div>
                            <button onClick={() => setShowVoiceModal(true)} className="text-gray-600 p-2 bg-gray-100 rounded-full hover:bg-gray-200">
                                <Icon name="settings" size={24} />
                            </button>
                        </div>

                        <div className="flex-1 flex flex-col items-center p-4 text-center overflow-y-auto scrollbar-hide">
                            <div className="bg-white w-full rounded-3xl shadow-lg p-5 mb-4 border-b-4 border-blue-200">
                                <h2 className={`${currentWord.en.length > 10 ? 'text-4xl' : 'text-5xl'} font-bold text-slate-800 mb-2 tracking-wide break-words`}>{currentWord.en}</h2>
                                <div className="text-xl text-gray-500 font-mono mb-2">/{currentWord.ipa}/</div>
                                <div className="text-2xl text-orange-600 font-bold mb-4">{currentWord.zh}</div>
                                
                                <div className="flex justify-center gap-2 mb-4">
                                    <button onClick={() => setSpeechRate(1.0)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 1.0 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>æ­£å¸¸</button>
                                    <button onClick={() => setSpeechRate(0.6)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 0.6 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>æ…¢ (60%)</button>
                                    <button onClick={() => setSpeechRate(0.1)} className={`px-3 py-1 rounded-full text-sm font-bold border-2 transition-colors ${speechRate === 0.1 ? 'bg-blue-500 text-white border-blue-500' : 'bg-white text-gray-400 border-gray-200'}`}>æ¥µæ…¢ (10%)</button>
                                </div>

                                <div className="bg-gray-100 inline-block px-4 py-2 rounded-full text-lg text-gray-600 mb-6">ç™¼éŸ³åƒï¼š{currentWord.pronunciation}</div>
                                
                                <button onClick={() => speak(currentWord.en)} className="bg-blue-500 text-white w-full rounded-xl p-3 shadow-md mb-4 active:scale-95 transition-transform flex items-center justify-center gap-2">
                                    <Icon name="volume" size={24} />
                                    <span className="text-xl font-bold">è½å–®å­—</span>
                                </button>

                                <div className="border-t pt-4">
                                    <p className="text-lg text-gray-500 mb-1">ä¾‹å¥ï¼š</p>
                                    <div className="flex items-center justify-center gap-2">
                                        <p className="text-lg text-slate-700 font-medium text-left flex-1">{currentWord.sentence}</p>
                                        <button onClick={() => speak(currentWord.sentence)} className="bg-blue-100 text-blue-600 p-3 rounded-full hover:bg-blue-200">
                                            <Icon name="volume" size={20} />
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="w-full bg-indigo-50 rounded-2xl p-4 border-2 border-indigo-100">
                                <div className="text-lg font-bold text-indigo-800 mb-2">å£èªªç·´ç¿’</div>
                                <div className="flex flex-col items-center">
                                    <button 
                                        onClick={startListening}
                                        disabled={isListening}
                                        className={`w-20 h-20 rounded-full flex items-center justify-center shadow-lg transition-all ${isListening ? 'bg-red-500 pulse-animation' : 'bg-white border-4 border-indigo-200 text-indigo-500'}`}
                                    >
                                        <Icon name="mic" size={40} className={isListening ? 'text-white' : ''} />
                                    </button>
                                    <div className="mt-2 h-8">
                                        {isListening && <span className="text-red-500 font-bold animate-pulse">è«‹å¤§è²å”¸å‡ºä¾†...</span>}
                                        {!isListening && !speakFeedback && <span className="text-gray-400 text-sm">é»æ“Šéº¥å…‹é¢¨é–‹å§‹éŒ„éŸ³</span>}
                                        {!isListening && speakFeedback === 'match' && <span className="text-green-600 font-bold text-lg">å¤ªæ£’äº†ï¼å”¸å°äº†ï¼ğŸ‰</span>}
                                        {!isListening && speakFeedback === 'no-match' && (
                                            <div className="text-orange-500 font-bold">
                                                <span>å†è©¦ä¸€æ¬¡å–”ï¼</span>
                                                <div className="text-xs text-gray-400 font-normal">è½åˆ°ï¼š{recognizedText}</div>
                                            </div>
                                        )}
                                        {!isListening && speakFeedback === 'error' && <span className="text-red-400 text-sm">ç„¡æ³•ä½¿ç”¨éº¥å…‹é¢¨</span>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="shrink-0 p-4 bg-white flex justify-between gap-4 border-t z-10">
                            <button onClick={prevCard} disabled={currentIndex === 0} className={`flex-1 py-4 rounded-xl text-xl font-bold ${currentIndex === 0 ? 'bg-gray-100 text-gray-300' : 'bg-gray-200 text-gray-700'}`}>ä¸Šä¸€å€‹</button>
                            {currentIndex === activeWords.length - 1 ? (
                                <button onClick={startQuizMode} className="flex-1 bg-orange-500 text-white py-4 rounded-xl text-xl font-bold shadow-md btn-press">é–‹å§‹æ¸¬é©—</button>
                            ) : (
                                <button onClick={nextCard} className="flex-1 bg-blue-600 text-white py-4 rounded-xl text-xl font-bold shadow-md btn-press">ä¸‹ä¸€å€‹</button>
                            )}
                        </div>

                        {showVoiceModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-2xl w-full max-w-sm max-h-[80vh] flex flex-col shadow-2xl">
                                    <div className="p-4 border-b flex justify-between items-center">
                                        <h3 className="text-xl font-bold text-slate-800">é¸æ“‡ç™¼éŸ³äºº</h3>
                                        <button onClick={() => setShowVoiceModal(false)} className="text-gray-500 hover:text-gray-700"><Icon name="x" size={24} /></button>
                                    </div>
                                    <div className="p-4 bg-blue-50 text-sm text-blue-800 rounded-lg mx-4 mt-2 mb-2">
                                        <strong>ğŸ’¡ è¦ºå¾—è²éŸ³åƒæ©Ÿå™¨äººï¼Ÿ</strong>
                                        <ul className="list-disc pl-4 mt-1 space-y-1">
                                            <li><strong>iPhone:</strong> è¨­å®š > è¼”åŠ©ä½¿ç”¨ > èªéŸ³å…§å®¹ > ä¸‹è¼‰ Siri/å¢å¼·ç‰ˆè²éŸ³ã€‚</li>
                                            <li><strong>Android:</strong> è¨­å®š > æ–‡å­—è½‰èªéŸ³ > æ›´æ–° Google èªéŸ³æœå‹™ã€‚</li>
                                        </ul>
                                    </div>
                                    <div className="p-2 overflow-y-auto flex-1">
                                        {availableVoices.length === 0 ? <div className="text-center p-4 text-gray-500">æ‰¾ä¸åˆ°å¯ç”¨çš„è‹±æ–‡èªéŸ³</div> : 
                                            availableVoices.map((voice, idx) => {
                                                const nameLower = voice.name.toLowerCase();
                                                const isHighQuality = nameLower.includes('siri') || nameLower.includes('enhanced') || nameLower.includes('premium') || nameLower.includes('google') || nameLower.includes('natural');
                                                return (
                                                    <button key={idx} onClick={() => selectVoiceAndTest(voice)} className={`w-full text-left p-4 rounded-xl mb-2 flex items-center justify-between border-2 transition-all ${selectedVoice && selectedVoice.name === voice.name ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-gray-100 hover:border-blue-200'}`}>
                                                        <div>
                                                            <div className="font-bold text-lg flex items-center">
                                                                è²éŸ³ {idx + 1}
                                                                {isHighQuality && <span className="ml-2 text-xs bg-orange-100 text-orange-600 px-2 py-0.5 rounded-full border border-orange-200">ğŸ‘ æ¨è–¦</span>}
                                                            </div>
                                                            <div className="text-xs text-gray-400 truncate w-48">{voice.name}</div>
                                                        </div>
                                                        {selectedVoice && selectedVoice.name === voice.name && <Icon name="check" className="text-blue-500" />}
                                                    </button>
                                                );
                                            })
                                        }
                                    </div>
                                    <div className="p-4 border-t">
                                        <button onClick={() => setShowVoiceModal(false)} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold text-lg shadow-md">ç¢ºå®š</button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            if (screen === 'quiz') {
                return (
                    <div className="h-[100dvh] w-full bg-indigo-50 flex flex-col max-w-md mx-auto shadow-xl overflow-hidden">
                        <div className="shrink-0 p-4 text-center">
                            <div className="text-2xl font-bold text-indigo-800">å°æ¸¬é©—</div>
                            <div className="text-gray-500">é¸å‡ºæ­£ç¢ºçš„ä¸­æ–‡æ„æ€</div>
                        </div>
                        <div className="flex-1 flex flex-col items-center p-6 overflow-y-auto scrollbar-hide">
                            <div className="bg-white w-full rounded-2xl shadow-md p-8 mb-8 text-center relative overflow-hidden shrink-0">
                                {quizFeedback === 'correct' && <div className="absolute inset-0 bg-green-100 flex items-center justify-center z-10"><div className="text-green-600 font-bold text-4xl flex flex-col items-center"><Icon name="check" size={64} /><div>ç­”å°äº†ï¼</div></div></div>}
                                {quizFeedback === 'incorrect' && <div className="absolute inset-0 bg-red-100 flex items-center justify-center z-10"><div className="text-red-500 font-bold text-4xl flex flex-col items-center"><Icon name="x" size={64} /><div>å†è©¦ä¸€æ¬¡</div></div></div>}
                                <div className={`${currentWord.en.length > 10 ? 'text-4xl' : 'text-5xl'} font-bold text-slate-800 mb-4 break-words`}>{currentWord.en}</div>
                                <button onClick={() => speak(currentWord.en)} className="text-blue-500 mx-auto block p-2"><Icon name="volume" size={32} /></button>
                            </div>
                            <div className="w-full space-y-4 pb-4">
                                {quizOptions.map((option, idx) => (
                                    <button key={idx} onClick={() => handleQuizAnswer(option)} className="w-full bg-white hover:bg-indigo-100 border-2 border-indigo-100 rounded-xl p-6 text-2xl font-bold text-slate-700 shadow-sm btn-press transition-colors">{option.zh}</button>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'result') {
                return (
                    <div className="h-[100dvh] w-full bg-yellow-50 flex flex-col items-center justify-center max-w-md mx-auto p-6 text-center overflow-hidden">
                        <div className="bg-white p-8 rounded-3xl shadow-xl w-full">
                            <div className="text-yellow-500 flex justify-center mb-4"><Icon name="star" size={80} className="fill-current" /></div>
                            <h2 className="text-4xl font-bold text-slate-800 mb-4">æ­å–œå®Œæˆï¼</h2>
                            <p className="text-xl text-gray-600 mb-8">ä»Šå¤©çš„å¤§è…¦é‹å‹•åšå¾—å¾ˆæ£’å–”ï¼</p>
                            <div className="space-y-4">
                                <button onClick={() => setScreen('home')} className="w-full bg-orange-500 text-white text-2xl font-bold py-4 rounded-xl shadow-md btn-press">å›é¦–é </button>
                                <button onClick={() => startCategory(activeCategory)} className="w-full bg-white border-2 border-orange-200 text-orange-600 text-xl font-bold py-4 rounded-xl btn-press">å†ç·´ç¿’ä¸€æ¬¡</button>
                            </div>
                        </div>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
